# background

普段その場の値段で買い物をしているので、時期や店舗による違いをみたい

OCRはレシートくらいなら一通り開拓された分野のはずで、開発練習のいいネタ

# objective

撮影したレシートをOCRした結果をCSV形式に落とし込み、同種の買い物の価格を比較する。


# what it does

大手が提供するAPIに画像を投げて、結果を取得し、parseする


# what it does NOT

データ分析基盤の提供
OCRモデルの自前での開発
Vision APIの結果に対する修正
Vision APIが上手くいくような画像補正
ちゃんとしたDB（interfaceだけ用意して、中身はcsvにする）
デプロイ

# environment

web
localhost

# overview

1. フロントから撮影した画像を取得
2. 撮影した画像をアップロード
3. アップロードされた画像を保存する
4. 保存されている画像をAPIに送る
5. 結果を受け取ってparseする
6. 整理された結果をDBに格納

DBには別の方法でアクセス

## 記述選定
### 試したいこと
* 自動テスト
* React Hooks
* typescript gRPC
* google vision API
* github projects

### 採用
試したいこと全部採用
# detail
## 格納するデータ
### 必須項目
#### レシート単位
購入場所、購入店舗、購入日時
#### レシートごとに複数ある項目
購入商品、金額、個数
### あれば嬉しい
レシート撮影日時、会計総額（OCR結果の確認につかえる？）、税込みが税抜きか
## 格納形式
テーブルは分けず、
1recordあたり、「購入場所、購入店舗、購入日時、購入商品、個数、金額」をひたすらcsvに積んでいく。


## 各ステップ詳細
### 1フロントから撮影した画像を取得
react のカメラにアクセスするコンポーネントを使って、画像を撮影
コンポーネント：
画像の形式：
画像のサイズ：
### 2撮影した画像をアップロード
ローカルホストに立てたbackendに画像を非同期で送る(アップロード)
コンポーネント：fetch API?
### 3アップロードされた画像を保存する
localhostにサーバーを立てておき、画像を受け取る。
ローカルに画像を保存する
サーバー：
画像の保存形式：

### 4保存されている画像をAPIに送る
画像をロードしてきて、gRPCでGoogle Vision APIを叩く
送って結果を受け取る部分は単一モジュールとして切り出し、もし自前でOCRモデルを立てたら挿げ替えられるようにする
requestの形式：

### 5結果を受け取ってparseする
APIが上手く結果を返してきたか判定
成功　ー＞　結果を保存しつつ、必要なデータを抽出
失敗　ー＞　エラーとしてログを吐き出す（リトライはしない。）
レスポンスの形式：
### 6整理された結果をDBに格納
受け取った結果を整理してcsvに格納
csvの扱い：ライブラリor自分でparse

# schedule
2021.5 GW
5/1 design doc作成
5/2 gRPC使い方確認 Vision API
5/3 Vision API  サーバー立てる
5/4 react hooks 使い方確認
5/5 アップロード

